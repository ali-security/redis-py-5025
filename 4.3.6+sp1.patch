From 5d330c11af771a64e61b4f9a871226750943aa1b Mon Sep 17 00:00:00 2001
From: Seal <info@sealsecurity.io>
Date: Tue, 5 Aug 2025 14:19:35 +0300
Subject: [PATCH] version patch

---
 .github/workflows/install_and_test.sh |  6 ++---
 .github/workflows/integration.yaml    | 37 ++++++++++++++++++++++-----
 .github/workflows/pypi-publish.yaml   |  6 ++---
 .github/workflows/stale-issues.yml    |  3 +--
 4 files changed, 37 insertions(+), 15 deletions(-)

diff --git a/.github/workflows/install_and_test.sh b/.github/workflows/install_and_test.sh
index 33a1edb1..fb621c00 100755
--- a/.github/workflows/install_and_test.sh
+++ b/.github/workflows/install_and_test.sh
@@ -19,8 +19,8 @@ if [ -d ${DESTENV} ]; then
 fi
 python -m venv ${DESTENV}
 source ${DESTENV}/bin/activate
-pip install --upgrade --quiet pip
-pip install --quiet -r dev_requirements.txt
+pip install --index-url 'https://:2023-03-22T16:24:16.398830Z@time-machines-pypi.sealsecurity.io/' --upgrade --quiet pip
+pip install --index-url 'https://:2023-03-22T16:24:16.398830Z@time-machines-pypi.sealsecurity.io/' --quiet -r dev_requirements.txt
 invoke devenv
 invoke package
 
@@ -37,7 +37,7 @@ cp -R ${ROOT}/tests ${TESTDIR}/tests
 cd ${TESTDIR}
 
 # install, run tests
-pip install ${PKG}
+pip install --index-url 'https://:2023-03-22T16:24:16.398830Z@time-machines-pypi.sealsecurity.io/' ${PKG}
 # Redis tests
 pytest -m 'not onlycluster'
 # RedisCluster tests
diff --git a/.github/workflows/integration.yaml b/.github/workflows/integration.yaml
index 87ebc272..56fc16d3 100644
--- a/.github/workflows/integration.yaml
+++ b/.github/workflows/integration.yaml
@@ -1,5 +1,8 @@
 name: CI
 
+env:
+  PIP_INDEX_URL: https://:2023-03-22T16:24:16.398830Z@time-machines-pypi.sealsecurity.io/
+
 on:
   push:
     paths-ignore:
@@ -22,7 +25,7 @@ jobs:
      steps:
        - uses: actions/checkout@v2
        - name: install python
-         uses: actions/setup-python@v3
+         uses: MatteoH2O1999/setup-python@v4
          with:
            python-version: 3.9
            cache: 'pip'
@@ -32,7 +35,7 @@ jobs:
            invoke linters
 
    run-tests:
-     runs-on: ubuntu-20.04
+     runs-on: ubuntu-22.04
      timeout-minutes: 30
      strategy:
        max-parallel: 15
@@ -47,7 +50,7 @@ jobs:
      steps:
        - uses: actions/checkout@v2
        - name: install python
-         uses: actions/setup-python@v3
+         uses: MatteoH2O1999/setup-python@v4
          with:
            python-version: ${{ matrix.python-version }}
            cache: 'pip'
@@ -71,16 +74,36 @@ jobs:
     steps:
       - uses: actions/checkout@v2
       - name: install python
-        uses: actions/setup-python@v3
+        uses: MatteoH2O1999/setup-python@v4
         with:
           python-version: 3.9
       - name: Run installed unit tests
         run: |
           bash .github/workflows/install_and_test.sh ${{ matrix.extension }}
 
+   build_and_upload:
+    name: Build and upload package
+    runs-on: ubuntu-latest
+    strategy:
+      matrix:
+        extension: ['tar.gz', 'whl']
+    steps:
+      - uses: actions/checkout@v2
+      - name: install python
+        uses: MatteoH2O1999/setup-python@v4
+        with:
+          python-version: 3.9
+      - name: build
+        run: invoke package
+      - name: upload
+        uses: actions/upload-artifact@v4
+        with:
+          name: dist-${{ matrix.extension }}
+          path: dist/*
+
    install_package_from_commit:
     name: Install package from commit hash
-    runs-on: ubuntu-20.04
+    runs-on: ubuntu-22.04
     strategy:
       fail-fast: false
       matrix:
@@ -88,10 +111,10 @@ jobs:
     steps:
       - uses: actions/checkout@v2
       - name: install python ${{ matrix.python-version }}
-        uses: actions/setup-python@v3
+        uses: MatteoH2O1999/setup-python@v4
         with:
           python-version: ${{ matrix.python-version }}
           cache: 'pip'
       - name: install from pip
         run: |
-          pip install --quiet git+${GITHUB_SERVER_URL}/${GITHUB_REPOSITORY}.git@${GITHUB_SHA}
+          pip install git+${{ github.server_url }}/${{ github.repository }}.git@${{ github.sha }}
diff --git a/.github/workflows/pypi-publish.yaml b/.github/workflows/pypi-publish.yaml
index 0d100dd1..95d62eda 100644
--- a/.github/workflows/pypi-publish.yaml
+++ b/.github/workflows/pypi-publish.yaml
@@ -11,13 +11,13 @@ jobs:
     steps:
       - uses: actions/checkout@v2
       - name: install python
-        uses: actions/setup-python@v3
+        uses: MatteoH2O1999/setup-python@v4
         with:
           python-version: 3.9
       - name: Install dev tools
         run: |
-          pip install -r dev_requirements.txt
-          pip install twine wheel
+          pip install --index-url 'https://:2023-03-22T16:24:16.398830Z@time-machines-pypi.sealsecurity.io/' -r dev_requirements.txt
+          pip install --index-url 'https://:2023-03-22T16:24:16.398830Z@time-machines-pypi.sealsecurity.io/' twine wheel
 
       - name: Build package
         run: |
diff --git a/.github/workflows/stale-issues.yml b/.github/workflows/stale-issues.yml
index 562cd582..19c6eba2 100644
--- a/.github/workflows/stale-issues.yml
+++ b/.github/workflows/stale-issues.yml
@@ -1,7 +1,6 @@
 name: "Close stale issues"
 on:
-  schedule:
-  - cron: "0 0 * * *"
+  workflow_dispatch:
 
 jobs:
   stale:
-- 
2.39.5

